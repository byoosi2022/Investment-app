[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Investment App",
  "enabled": 0,
  "modified": "2024-09-01 18:00:58.310629",
  "module": "Loan and Investment App",
  "name": "Jounal",
  "script": "frappe.ui.form.on('Investment App', {\r\n    before_save: function(frm) {\r\n        frappe.call({\r\n            method: 'loan_investment_app.loan_and_investment_app.doctype.investment_app.investment_app.on_update',\r\n            args: {\r\n                // Pass any required arguments if needed\r\n            },\r\n            callback: function(response) {\r\n                if (response.message) {\r\n                    // Handle success response\r\n                    frappe.msgprint(response.message);\r\n                    console.log(response.name); // Journal Entry document name\r\n                } else if (response.error) {\r\n                    // Handle error response\r\n                    frappe.msgprint(response.error);\r\n                    console.error(response.error);\r\n                }\r\n            }\r\n        });\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Investment App",
  "enabled": 1,
  "modified": "2024-09-08 15:06:16.248907",
  "module": "Loan and Investment App",
  "name": "Uupdate Member",
  "script": "frappe.ui.form.on('Investment App', {\r\n    validate: function(frm) {\r\n        // Fetch Member document only if Transaction Type is 'Request Payment'\r\n        if (frm.doc.party && frm.doc.transaction_type === 'Request Payment') {\r\n            frappe.call({\r\n                method: 'frappe.client.get',\r\n                args: {\r\n                    doctype: 'Member',\r\n                    name: frm.doc.party  // Assuming party is the name of Member\r\n                },\r\n                callback: function(response) {\r\n                    var member = response.message;\r\n                    if (member) {\r\n                        // Check if the fields are not already set\r\n                        if (!member.custom_investor_bank_name || \r\n                            !member.custom_investor_account_number || \r\n                            !member.custom_investor_account_name) {\r\n                            \r\n                            // Update the Member document with the new values\r\n                            frappe.call({\r\n                                method: 'frappe.client.set_value',\r\n                                args: {\r\n                                    doctype: 'Member',\r\n                                    name: member.name,\r\n                                    fieldname: {\r\n                                        'custom_investor_bank_name': frm.doc.investor_bank_name,\r\n                                        'custom_investor_account_number': frm.doc.investor_account_number,\r\n                                        'custom_investor_account_name': frm.doc.investor_account_name\r\n                                    }\r\n                                },\r\n                                callback: function(r) {\r\n                                    if (!r.exc) {\r\n                                        frappe.msgprint(__('Member details updated successfully!'));\r\n                                    }\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // Prevent saving the Investment App\r\n                            // frappe.msgprint(__('Member details are already updated. The Investment App cannot be saved.'));\r\n                            // frm.cancel();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            // Prevent saving the Investment App until the callback is complete\r\n            frappe.validated = false; // Prevent form submission\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Investment App",
  "enabled": 1,
  "modified": "2024-09-08 13:02:02.898071",
  "module": "Loan and Investment App",
  "name": "Update Member",
  "script": "frappe.ui.form.on('Investment App', {\r\n    validate: function(frm) {\r\n        // Fetch Member document only if Transaction Type is 'Request Payment'\r\n        if (frm.doc.party && frm.doc.transaction_type === 'Request Payment') {\r\n            frappe.call({\r\n                method: 'frappe.client.get',\r\n                args: {\r\n                    doctype: 'Member',\r\n                    name: frm.doc.party  // Assuming party is the name of Member\r\n                },\r\n                callback: function(response) {\r\n                    var member = response.message;\r\n                    if (member) {\r\n                        // Check if the fields are not already set\r\n                        if (!member.custom_investor_bank_name || \r\n                            !member.custom_investor_account_number || \r\n                            !member.custom_investor_account_name) {\r\n                            \r\n                            // Update the Member document with the new values\r\n                            frappe.call({\r\n                                method: 'frappe.client.set_value',\r\n                                args: {\r\n                                    doctype: 'Member',\r\n                                    name: member.name,\r\n                                    fieldname: {\r\n                                        'custom_investor_bank_name': frm.doc.investor_bank_name,\r\n                                        'custom_investor_account_number': frm.doc.investor_account_number,\r\n                                        'custom_investor_account_name': frm.doc.investor_account_name\r\n                                    }\r\n                                },\r\n                                callback: function(r) {\r\n                                    if (!r.exc) {\r\n                                        frappe.msgprint(__('Member details updated successfully!'));\r\n                                    }\r\n                                }\r\n                            });\r\n                        } else {\r\n                            // Prevent saving the Investment App\r\n                            // frappe.msgprint(__('Member details are already updated. The Investment App cannot be saved.'));\r\n                            // frm.cancel();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            // Prevent saving the Investment App until the callback is complete\r\n            frappe.validated = false; // Prevent form submission\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Investment App",
  "enabled": 1,
  "modified": "2024-09-12 02:23:01.141218",
  "module": "Loan and Investment App",
  "name": "work flow",
  "script": "frappe.ui.form.on('Investment App', {\n    refresh: function(frm) {\n        // A flag to check if the form has already been reloaded\n        if (frm.doc.__is_reload_done) {\n            return;  // Exit if the form has already been reloaded\n        }\n\n        // Check if transaction_type is already set\n        if (frm.doc.transaction_type) {\n            let workflow_name = 'Investment App (Request for Payment) Workflow';\n            let is_active = frm.doc.transaction_type === 'Request for Payments' ? 1 : 0;  // Set is_active based on transaction_type\n\n            // Call the Python function to update the workflow's is_active status\n            frappe.call({\n                method: 'loan_investment_app.custom_api.workflow.update_workflow_to_active',\n                args: {\n                    workflow_name: workflow_name,\n                    is_active: is_active\n                },\n                callback: function(response) {\n                    // Check the response to see if the workflow was updated\n                    if (response.message) {\n                        frappe.msgprint(response.message);\n                    }\n\n                    // Save the document after updating the workflow\n                    frm.save().then(() => {\n                        // Set the flag to indicate the form has been reloaded\n                        frm.doc.__is_reload_done = true;\n\n                        // Reload the document to reflect changes\n                        frm.reload_doc();\n                    }).catch((error) => {\n                        // Handle any errors that occur during the save\n                        frappe.msgprint(__('Error saving document: ' + error));\n                    });\n                },\n                error: function(error) {\n                    frappe.msgprint(__('An error occurred: ' + error));\n                }\n            });\n        } else {\n            // If transaction_type is not set, inform the user\n            frappe.msgprint(__('Transaction type is not set. Please select a transaction type.'));\n        }\n    }\n});",
  "view": "Form"
 }
]